<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Computer Simulator</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=JetBrains+Mono:wght@300;400;500&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'JetBrains Mono', monospace;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3e 50%, #0f0f2a 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            background: linear-gradient(90deg, #00ffff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #888;
            font-size: 0.9rem;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            gap: 20px;
        }
        
        .panel {
            background: rgba(20, 20, 50, 0.8);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(100, 100, 200, 0.2);
        }
        
        .panel-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            color: #00ffff;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
        }
        
        /* Gate Buttons */
        .gate-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .gate-btn {
            padding: 15px 10px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            border: 2px solid #333;
            border-radius: 10px;
            background: linear-gradient(145deg, #1a1a3a, #2a2a5a);
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .gate-btn:hover {
            transform: translateY(-3px);
            border-color: #00ffff;
            box-shadow: 0 5px 20px rgba(0, 255, 255, 0.3);
        }
        
        .gate-btn.hadamard { border-color: #ff6b6b; }
        .gate-btn.hadamard:hover { box-shadow: 0 5px 20px rgba(255, 107, 107, 0.4); }
        
        .gate-btn.pauli-x { border-color: #4ecdc4; }
        .gate-btn.pauli-x:hover { box-shadow: 0 5px 20px rgba(78, 205, 196, 0.4); }
        
        .gate-btn.pauli-z { border-color: #ffe66d; }
        .gate-btn.pauli-z:hover { box-shadow: 0 5px 20px rgba(255, 230, 109, 0.4); }
        
        .gate-btn.cnot { border-color: #ff00ff; grid-column: span 2; }
        .gate-btn.cnot:hover { box-shadow: 0 5px 20px rgba(255, 0, 255, 0.4); }
        
        /* Circuit Display */
        .circuit-area {
            min-height: 300px;
            position: relative;
        }
        
        .qubit-row {
            display: flex;
            align-items: center;
            height: 80px;
            margin-bottom: 20px;
            position: relative;
        }
        
        .qubit-label {
            width: 60px;
            font-family: 'Orbitron', sans-serif;
            color: #00ffff;
            font-size: 1.1rem;
        }
        
        .qubit-wire {
            flex: 1;
            height: 4px;
            background: linear-gradient(90deg, #333, #666);
            position: relative;
            border-radius: 2px;
        }
        
        .gate-visual {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-weight: bold;
            top: -23px;
            transform: translateX(-25px);
            animation: gateAppear 0.3s ease-out;
        }
        
        @keyframes gateAppear {
            from { transform: translateX(-25px) scale(0); opacity: 0; }
            to { transform: translateX(-25px) scale(1); opacity: 1; }
        }
        
        .gate-H { background: linear-gradient(145deg, #ff6b6b, #ee5a5a); color: white; }
        .gate-X { background: linear-gradient(145deg, #4ecdc4, #3dbdb5); color: white; }
        .gate-Y { background: linear-gradient(145deg, #a855f7, #9333ea); color: white; }
        .gate-Z { background: linear-gradient(145deg, #ffe66d, #ffd93d); color: #333; }
        .gate-S { background: linear-gradient(145deg, #22c55e, #16a34a); color: white; }
        .gate-T { background: linear-gradient(145deg, #f97316, #ea580c); color: white; }
        
        .cnot-control {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #ff00ff;
            border-radius: 50%;
            top: -8px;
            transform: translateX(-10px);
        }
        
        .cnot-target {
            position: absolute;
            width: 40px;
            height: 40px;
            border: 4px solid #ff00ff;
            border-radius: 50%;
            top: -18px;
            transform: translateX(-20px);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .cnot-target::before {
            content: '‚äï';
            font-size: 24px;
            color: #ff00ff;
        }
        
        .cnot-line {
            position: absolute;
            width: 4px;
            background: #ff00ff;
            left: 50%;
            transform: translateX(-50%);
        }
        
        /* Qubit State Display */
        .qubit-state {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }
        
        .state-sphere {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            position: relative;
            background: radial-gradient(circle at 30% 30%, #2a2a5a, #1a1a3a);
            border: 2px solid #444;
        }
        
        .state-vector {
            position: absolute;
            width: 4px;
            background: #ff00ff;
            bottom: 50%;
            left: 50%;
            transform-origin: bottom center;
            border-radius: 2px;
            transition: all 0.5s ease-out;
        }
        
        .state-dot {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #ff00ff;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 15px #ff00ff;
            transition: all 0.5s ease-out;
        }
        
        .state-info {
            flex: 1;
        }
        
        .state-equation {
            font-size: 1.1rem;
            color: #fff;
            margin-bottom: 8px;
        }
        
        .state-equation .alpha { color: #00ff88; }
        .state-equation .beta { color: #ff6b6b; }
        
        .prob-bars {
            display: flex;
            gap: 10px;
        }
        
        .prob-bar-container {
            flex: 1;
        }
        
        .prob-label {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 4px;
        }
        
        .prob-bar-bg {
            height: 20px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .prob-bar {
            height: 100%;
            transition: width 0.5s ease-out;
            border-radius: 5px;
        }
        
        .prob-bar-0 { background: linear-gradient(90deg, #00ff88, #00cc66); }
        .prob-bar-1 { background: linear-gradient(90deg, #ff6b6b, #ff4757); }
        
        /* Control Buttons */
        .control-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .control-btn {
            flex: 1;
            padding: 12px;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-measure {
            background: linear-gradient(145deg, #ff00ff, #cc00cc);
            color: white;
        }
        
        .btn-reset {
            background: linear-gradient(145deg, #333, #444);
            color: white;
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        /* Measurement Result */
        .measurement-result {
            text-align: center;
            padding: 20px;
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            min-height: 80px;
        }
        
        .result-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 3rem;
            font-weight: 900;
        }
        
        .result-0 { color: #00ff88; text-shadow: 0 0 30px rgba(0, 255, 136, 0.8); }
        .result-1 { color: #ff6b6b; text-shadow: 0 0 30px rgba(255, 107, 107, 0.8); }
        
        /* History */
        .history-list {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .history-item {
            padding: 8px 12px;
            margin-bottom: 5px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            font-size: 0.85rem;
            border-left: 3px solid #00ffff;
        }
        
        /* Preset Circuits */
        .preset-btn {
            width: 100%;
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
            border-radius: 8px;
            color: #ccc;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s;
        }
        
        .preset-btn:hover {
            border-color: #00ffff;
            color: #fff;
        }
        
        .preset-name {
            font-weight: bold;
            color: #00ffff;
        }
        
        /* Qubit Selector */
        .qubit-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .qubit-select-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #333;
            border-radius: 8px;
            background: transparent;
            color: #888;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            transition: all 0.3s;
        }
        
        .qubit-select-btn.active {
            border-color: #00ffff;
            color: #00ffff;
            background: rgba(0, 255, 255, 0.1);
        }
        
        /* Explanation Panel */
        .explanation {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(0, 255, 255, 0.2);
        }
        
        .explanation-title {
            color: #00ffff;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        
        .explanation-text {
            font-size: 0.85rem;
            color: #aaa;
            line-height: 1.5;
        }
        
        /* Animation for measurement */
        @keyframes measurePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .measuring {
            animation: measurePulse 0.3s ease-in-out 3;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>QUANTUM SIMULATOR</h1>
            <p class="subtitle">Ë¶ñË¶öÁöÑ„Å´Â≠¶„Å∂ÈáèÂ≠ê„Ç≥„É≥„Éî„É•„Éº„ÉÜ„Ç£„É≥„Ç∞</p>
        </header>
        
        <div class="main-grid">
            <!-- Left Panel: Gates -->
            <div class="panel">
                <div class="panel-title">üéõÔ∏è ÈáèÂ≠ê„Ç≤„Éº„Éà</div>
                
                <div style="margin-bottom: 15px; color: #888; font-size: 0.85rem;">
                    ÂØæË±°ÈáèÂ≠ê„Éì„ÉÉ„Éà:
                </div>
                <div class="qubit-selector">
                    <button class="qubit-select-btn active" onclick="selectQubit(0)">Q0</button>
                    <button class="qubit-select-btn" onclick="selectQubit(1)">Q1</button>
                </div>
                
                <div class="gate-grid">
                    <button class="gate-btn hadamard" onclick="applyGate('H')">H</button>
                    <button class="gate-btn pauli-x" onclick="applyGate('X')">X</button>
                    <button class="gate-btn" onclick="applyGate('Y')">Y</button>
                    <button class="gate-btn pauli-z" onclick="applyGate('Z')">Z</button>
                    <button class="gate-btn" onclick="applyGate('S')">S</button>
                    <button class="gate-btn" onclick="applyGate('T')">T</button>
                    <button class="gate-btn cnot" onclick="applyCNOT()">CNOT</button>
                </div>
                
                <div class="control-buttons">
                    <button class="control-btn btn-measure" onclick="measure()">‚ö° Ê∏¨ÂÆö</button>
                    <button class="control-btn btn-reset" onclick="reset()">‚Ü∫ „É™„Çª„ÉÉ„Éà</button>
                </div>
                
                <div class="explanation">
                    <div class="explanation-title">üí° „Ç≤„Éº„Éà„ÅÆË™¨Êòé</div>
                    <div class="explanation-text" id="gateExplanation">
                        „Ç≤„Éº„Éà„Éú„Çø„É≥„Çí„Éõ„Éê„Éº„Åô„Çã„Å®Ë™¨Êòé„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô
                    </div>
                </div>
            </div>
            
            <!-- Center Panel: Circuit -->
            <div class="panel">
                <div class="panel-title">‚ö° ÈáèÂ≠êÂõûË∑Ø</div>
                
                <div class="circuit-area" id="circuitArea">
                    <div class="qubit-row" id="qubitRow0">
                        <div class="qubit-label">|q‚ÇÄ‚ü©</div>
                        <div class="qubit-wire" id="wire0"></div>
                    </div>
                    <div class="qubit-row" id="qubitRow1">
                        <div class="qubit-label">|q‚ÇÅ‚ü©</div>
                        <div class="qubit-wire" id="wire1"></div>
                    </div>
                </div>
                
                <!-- Qubit States -->
                <div class="panel-title" style="margin-top: 20px;">üìä ÈáèÂ≠êÁä∂ÊÖã</div>
                
                <div class="qubit-state" id="qubitState0">
                    <div class="state-sphere" id="sphere0">
                        <div class="state-vector" id="vector0" style="height: 35px; transform: rotate(0deg);"></div>
                        <div class="state-dot" id="dot0" style="top: 15%; left: 50%;"></div>
                    </div>
                    <div class="state-info">
                        <div class="state-equation">
                            |q‚ÇÄ‚ü© = <span class="alpha" id="alpha0">1.000</span>|0‚ü© + <span class="beta" id="beta0">0.000</span>|1‚ü©
                        </div>
                        <div class="prob-bars">
                            <div class="prob-bar-container">
                                <div class="prob-label">P(|0‚ü©) = <span id="prob0_0">100%</span></div>
                                <div class="prob-bar-bg">
                                    <div class="prob-bar prob-bar-0" id="bar0_0" style="width: 100%"></div>
                                </div>
                            </div>
                            <div class="prob-bar-container">
                                <div class="prob-label">P(|1‚ü©) = <span id="prob0_1">0%</span></div>
                                <div class="prob-bar-bg">
                                    <div class="prob-bar prob-bar-1" id="bar0_1" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="qubit-state" id="qubitState1">
                    <div class="state-sphere" id="sphere1">
                        <div class="state-vector" id="vector1" style="height: 35px; transform: rotate(0deg);"></div>
                        <div class="state-dot" id="dot1" style="top: 15%; left: 50%;"></div>
                    </div>
                    <div class="state-info">
                        <div class="state-equation">
                            |q‚ÇÅ‚ü© = <span class="alpha" id="alpha1">1.000</span>|0‚ü© + <span class="beta" id="beta1">0.000</span>|1‚ü©
                        </div>
                        <div class="prob-bars">
                            <div class="prob-bar-container">
                                <div class="prob-label">P(|0‚ü©) = <span id="prob1_0">100%</span></div>
                                <div class="prob-bar-bg">
                                    <div class="prob-bar prob-bar-0" id="bar1_0" style="width: 100%"></div>
                                </div>
                            </div>
                            <div class="prob-bar-container">
                                <div class="prob-label">P(|1‚ü©) = <span id="prob1_1">0%</span></div>
                                <div class="prob-bar-bg">
                                    <div class="prob-bar prob-bar-1" id="bar1_1" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Panel: Results & Presets -->
            <div class="panel">
                <div class="panel-title">üéØ Ê∏¨ÂÆöÁµêÊûú</div>
                
                <div class="measurement-result" id="measurementResult">
                    <div style="color: #666;">Ê∏¨ÂÆö„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
                </div>
                
                <div class="panel-title" style="margin-top: 20px;">üìö „Éó„É™„Çª„ÉÉ„ÉàÂõûË∑Ø</div>
                
                <button class="preset-btn" onclick="loadPreset('bell')">
                    <div class="preset-name">„Éô„É´Áä∂ÊÖã</div>
                    <div style="font-size: 0.8rem; color: #888;">ÈáèÂ≠ê„Ç®„É≥„Çø„É≥„Ç∞„É´„É°„É≥„Éà</div>
                </button>
                
                <button class="preset-btn" onclick="loadPreset('superposition')">
                    <div class="preset-name">Èáç„Å≠Âêà„Çè„Åõ</div>
                    <div style="font-size: 0.8rem; color: #888;">H ‚Üí 50/50 „ÅÆÁ¢∫Áéá</div>
                </button>
                
                <button class="preset-btn" onclick="loadPreset('notgate')">
                    <div class="preset-name">NOT „Ç≤„Éº„Éà</div>
                    <div style="font-size: 0.8rem; color: #888;">|0‚ü© ‚Üí |1‚ü© ÂèçËª¢</div>
                </button>
                
                <button class="preset-btn" onclick="loadPreset('phase')">
                    <div class="preset-name">‰ΩçÁõ∏ÂõûËª¢</div>
                    <div style="font-size: 0.8rem; color: #888;">H ‚Üí Z ‚Üí H</div>
                </button>
                
                <div class="panel-title" style="margin-top: 20px;">üìù Êìç‰ΩúÂ±•Ê≠¥</div>
                <div class="history-list" id="historyList"></div>
            </div>
        </div>
    </div>
    
    <script>
        // ÈáèÂ≠ê„Éì„ÉÉ„Éà„ÇØ„É©„Çπ
        class Qubit {
            constructor() {
                this.alpha = { re: 1, im: 0 };
                this.beta = { re: 0, im: 0 };
            }
            
            get prob0() {
                return this.alpha.re ** 2 + this.alpha.im ** 2;
            }
            
            get prob1() {
                return this.beta.re ** 2 + this.beta.im ** 2;
            }
            
            normalize() {
                const norm = Math.sqrt(this.prob0 + this.prob1);
                if (norm > 0) {
                    this.alpha.re /= norm;
                    this.alpha.im /= norm;
                    this.beta.re /= norm;
                    this.beta.im /= norm;
                }
            }
            
            applyMatrix(m) {
                const newAlpha = {
                    re: m[0][0].re * this.alpha.re - m[0][0].im * this.alpha.im +
                        m[0][1].re * this.beta.re - m[0][1].im * this.beta.im,
                    im: m[0][0].re * this.alpha.im + m[0][0].im * this.alpha.re +
                        m[0][1].re * this.beta.im + m[0][1].im * this.beta.re
                };
                const newBeta = {
                    re: m[1][0].re * this.alpha.re - m[1][0].im * this.alpha.im +
                        m[1][1].re * this.beta.re - m[1][1].im * this.beta.im,
                    im: m[1][0].re * this.alpha.im + m[1][0].im * this.alpha.re +
                        m[1][1].re * this.beta.im + m[1][1].im * this.beta.re
                };
                this.alpha = newAlpha;
                this.beta = newBeta;
                this.normalize();
            }
            
            measure() {
                if (Math.random() < this.prob0) {
                    this.alpha = { re: 1, im: 0 };
                    this.beta = { re: 0, im: 0 };
                    return 0;
                } else {
                    this.alpha = { re: 0, im: 0 };
                    this.beta = { re: 1, im: 0 };
                    return 1;
                }
            }
            
            reset() {
                this.alpha = { re: 1, im: 0 };
                this.beta = { re: 0, im: 0 };
            }
        }
        
        // ÈáèÂ≠ê„Ç≤„Éº„ÉàË°åÂàó
        const sqrt2 = Math.sqrt(2);
        const gates = {
            H: [
                [{ re: 1/sqrt2, im: 0 }, { re: 1/sqrt2, im: 0 }],
                [{ re: 1/sqrt2, im: 0 }, { re: -1/sqrt2, im: 0 }]
            ],
            X: [
                [{ re: 0, im: 0 }, { re: 1, im: 0 }],
                [{ re: 1, im: 0 }, { re: 0, im: 0 }]
            ],
            Y: [
                [{ re: 0, im: 0 }, { re: 0, im: -1 }],
                [{ re: 0, im: 1 }, { re: 0, im: 0 }]
            ],
            Z: [
                [{ re: 1, im: 0 }, { re: 0, im: 0 }],
                [{ re: 0, im: 0 }, { re: -1, im: 0 }]
            ],
            S: [
                [{ re: 1, im: 0 }, { re: 0, im: 0 }],
                [{ re: 0, im: 0 }, { re: 0, im: 1 }]
            ],
            T: [
                [{ re: 1, im: 0 }, { re: 0, im: 0 }],
                [{ re: 0, im: 0 }, { re: Math.cos(Math.PI/4), im: Math.sin(Math.PI/4) }]
            ]
        };
        
        const gateExplanations = {
            H: '„Ç¢„ÉÄ„Éû„Éº„É´ (H): Èáç„Å≠Âêà„Çè„Åõ„Çí‰ΩúÊàê„ÄÇ|0‚ü© ‚Üí (|0‚ü©+|1‚ü©)/‚àö2',
            X: '„Éë„Ç¶„É™X (NOT): „Éì„ÉÉ„ÉàÂèçËª¢„ÄÇ|0‚ü© ‚Üî |1‚ü©',
            Y: '„Éë„Ç¶„É™Y: YËª∏Âë®„Çä„ÅÆ180¬∞ÂõûËª¢',
            Z: '„Éë„Ç¶„É™Z: ‰ΩçÁõ∏ÂèçËª¢„ÄÇ|1‚ü© ‚Üí -|1‚ü©',
            S: 'S (‰ΩçÁõ∏): |1‚ü© ‚Üí i|1‚ü©',
            T: 'T (œÄ/8): |1‚ü© ‚Üí e^(iœÄ/4)|1‚ü©',
            CNOT: 'CNOT: Âà∂Âæ°NOT„Ç≤„Éº„Éà„ÄÇQ0„Åå1„ÅÆ„Å®„ÅçQ1„ÇíÂèçËª¢'
        };
        
        // Áä∂ÊÖã
        const qubits = [new Qubit(), new Qubit()];
        let selectedQubit = 0;
        let gatePositions = [60, 60];
        let history = [];
        let entangled = false;
        
        // ÈáèÂ≠ê„Éì„ÉÉ„ÉàÈÅ∏Êäû
        function selectQubit(q) {
            selectedQubit = q;
            document.querySelectorAll('.qubit-select-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === q);
            });
        }
        
        // „Ç≤„Éº„ÉàÈÅ©Áî®
        function applyGate(gateName) {
            qubits[selectedQubit].applyMatrix(gates[gateName]);
            addGateVisual(gateName, selectedQubit);
            addHistory(`${gateName} ‚Üí Q${selectedQubit}`);
            updateDisplay();
            
            if (entangled) {
                // „Ç®„É≥„Çø„É≥„Ç∞„É´Áä∂ÊÖã„ÅÆÊõ¥Êñ∞
                updateEntangledState();
            }
        }
        
        // CNOT „Ç≤„Éº„Éà
        function applyCNOT() {
            // Q0„ÅåÂà∂Âæ°„ÄÅQ1„Åå„Çø„Éº„Ç≤„ÉÉ„Éà
            if (qubits[0].prob1 > 0.001) {
                // Èáç„Å≠Âêà„Çè„Åõ„ÅÆÂ†¥Âêà„ÄÅ„Ç®„É≥„Çø„É≥„Ç∞„É´„É°„É≥„Éà„Çí‰ΩúÊàê
                const p0_0 = qubits[0].prob0;
                const p0_1 = qubits[0].prob1;
                
                if (p0_0 > 0.001 && p0_1 > 0.001) {
                    // „Ç®„É≥„Çø„É≥„Ç∞„É´„É°„É≥„ÉàÁä∂ÊÖã
                    entangled = true;
                }
                
                // Q0„Åå|1‚ü©„ÅÆÁ¢∫Áéá„ÅßQ1„ÇíÂèçËª¢
                if (qubits[0].beta.re !== 0 || qubits[0].beta.im !== 0) {
                    // Á∞°Áï•Âåñ: Q0„ÅÆ|1‚ü©ÊàêÂàÜ„Åå„ÅÇ„ÇãÂ†¥Âêà„ÄÅQ1„ÇíÂèçËª¢
                    const temp = qubits[1].alpha;
                    qubits[1].alpha = qubits[1].beta;
                    qubits[1].beta = temp;
                }
            }
            
            addCNOTVisual();
            addHistory('CNOT (Q0‚ÜíQ1)');
            updateDisplay();
        }
        
        // ÂõûË∑Ø‰∏ä„Å´„Ç≤„Éº„Éà„ÇíË°®Á§∫
        function addGateVisual(gateName, qubit) {
            const wire = document.getElementById(`wire${qubit}`);
            const gate = document.createElement('div');
            gate.className = `gate-visual gate-${gateName}`;
            gate.textContent = gateName;
            gate.style.left = `${gatePositions[qubit]}px`;
            wire.appendChild(gate);
            gatePositions[qubit] += 70;
        }
        
        // CNOT„ÅÆË¶ñË¶öË°®Á§∫
        function addCNOTVisual() {
            const wire0 = document.getElementById('wire0');
            const wire1 = document.getElementById('wire1');
            
            // Âà∂Âæ°ÁÇπ
            const control = document.createElement('div');
            control.className = 'cnot-control';
            control.style.left = `${gatePositions[0]}px`;
            wire0.appendChild(control);
            
            // „Çø„Éº„Ç≤„ÉÉ„Éà
            const target = document.createElement('div');
            target.className = 'cnot-target';
            target.style.left = `${gatePositions[1]}px`;
            wire1.appendChild(target);
            
            // Êé•Á∂öÁ∑ö
            const line = document.createElement('div');
            line.className = 'cnot-line';
            line.style.left = `${gatePositions[0]}px`;
            line.style.top = '0';
            line.style.height = '100px';
            wire0.appendChild(line);
            
            gatePositions[0] += 70;
            gatePositions[1] += 70;
        }
        
        // Ë°®Á§∫Êõ¥Êñ∞
        function updateDisplay() {
            for (let i = 0; i < 2; i++) {
                const q = qubits[i];
                
                // ÊåØÂπÖË°®Á§∫
                document.getElementById(`alpha${i}`).textContent = 
                    q.alpha.re.toFixed(3) + (q.alpha.im !== 0 ? `+${q.alpha.im.toFixed(3)}i` : '');
                document.getElementById(`beta${i}`).textContent = 
                    q.beta.re.toFixed(3) + (q.beta.im !== 0 ? `+${q.beta.im.toFixed(3)}i` : '');
                
                // Á¢∫ÁéáË°®Á§∫
                const p0 = q.prob0 * 100;
                const p1 = q.prob1 * 100;
                document.getElementById(`prob${i}_0`).textContent = `${p0.toFixed(1)}%`;
                document.getElementById(`prob${i}_1`).textContent = `${p1.toFixed(1)}%`;
                document.getElementById(`bar${i}_0`).style.width = `${p0}%`;
                document.getElementById(`bar${i}_1`).style.width = `${p1}%`;
                
                // „Éñ„É≠„ÉÉ„ÉõÁêÉ„ÅÆÊõ¥Êñ∞
                const theta = Math.acos(Math.sqrt(q.prob0)) * 2;
                const vectorLength = 35;
                const dotTop = 50 - Math.cos(theta) * 35;
                const dotLeft = 50 + Math.sin(theta) * 35;
                
                document.getElementById(`vector${i}`).style.height = `${vectorLength}px`;
                document.getElementById(`vector${i}`).style.transform = `rotate(${theta * 180 / Math.PI}deg)`;
                document.getElementById(`dot${i}`).style.top = `${dotTop}%`;
                document.getElementById(`dot${i}`).style.left = `${dotLeft}%`;
            }
        }
        
        // Ê∏¨ÂÆö
        function measure() {
            const resultDiv = document.getElementById('measurementResult');
            resultDiv.innerHTML = '<div class="measuring" style="font-size: 2rem;">‚ö°</div>';
            
            setTimeout(() => {
                const r0 = qubits[0].measure();
                const r1 = qubits[1].measure();
                
                resultDiv.innerHTML = `
                    <div style="font-size: 0.9rem; color: #888; margin-bottom: 10px;">Ê∏¨ÂÆöÁµêÊûú</div>
                    <div class="result-value result-${r0}">${r0}</div>
                    <div class="result-value result-${r1}">${r1}</div>
                    <div style="margin-top: 10px; font-size: 0.9rem; color: #888;">
                        |${r0}${r1}‚ü© „ÇíË¶≥Ê∏¨
                    </div>
                `;
                
                addHistory(`Ê∏¨ÂÆö: |${r0}${r1}‚ü©`);
                entangled = false;
                updateDisplay();
            }, 500);
        }
        
        // „É™„Çª„ÉÉ„Éà
        function reset() {
            qubits[0].reset();
            qubits[1].reset();
            gatePositions = [60, 60];
            entangled = false;
            history = [];
            
            document.getElementById('wire0').innerHTML = '';
            document.getElementById('wire1').innerHTML = '';
            document.getElementById('historyList').innerHTML = '';
            document.getElementById('measurementResult').innerHTML = 
                '<div style="color: #666;">Ê∏¨ÂÆö„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>';
            
            updateDisplay();
        }
        
        // Â±•Ê≠¥ËøΩÂä†
        function addHistory(text) {
            history.push(text);
            const historyList = document.getElementById('historyList');
            const item = document.createElement('div');
            item.className = 'history-item';
            item.textContent = text;
            historyList.insertBefore(item, historyList.firstChild);
        }
        
        // „Éó„É™„Çª„ÉÉ„ÉàË™≠„ÅøËæº„Åø
        function loadPreset(name) {
            reset();
            
            setTimeout(() => {
                switch (name) {
                    case 'bell':
                        selectQubit(0);
                        applyGate('H');
                        setTimeout(() => applyCNOT(), 300);
                        break;
                    case 'superposition':
                        selectQubit(0);
                        applyGate('H');
                        setTimeout(() => { selectQubit(1); applyGate('H'); }, 300);
                        break;
                    case 'notgate':
                        selectQubit(0);
                        applyGate('X');
                        break;
                    case 'phase':
                        selectQubit(0);
                        applyGate('H');
                        setTimeout(() => applyGate('Z'), 200);
                        setTimeout(() => applyGate('H'), 400);
                        break;
                }
            }, 100);
        }
        
        // „Ç≤„Éº„ÉàË™¨ÊòéË°®Á§∫
        document.querySelectorAll('.gate-btn').forEach(btn => {
            btn.addEventListener('mouseenter', function() {
                const gateName = this.textContent.trim();
                const explanation = gateExplanations[gateName] || '';
                document.getElementById('gateExplanation').textContent = explanation;
            });
        });
        
        // ÂàùÊúüÂåñ
        updateDisplay();
    </script>
</body>
</html>

